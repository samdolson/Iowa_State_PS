---
title: "Lab 4"
output: pdf_document
date: "2024-09-18"
---

[Stat 5000]{.smallcaps}[Lab #4]{.smallcaps}\
[Fall 2024]{.smallcaps} [Due Tue Sep 24th]{.smallcaps}
[Name:]{.smallcaps} \

**Directions:** Complete the exercises below. When you are finished,
turn in any required files online in Canvas, then check-in with the Lab
TA for dismissal.\

**[Diagnosing Assumptions in R]{.underline}**

Consider an experiment on the effects of vitamins on the growth of
guinea pig teeth. The file, `guinea_teeth.csv` (posted in Canvas)
contains the length of teeth (`growth`) for guinea pigs whose diets were
randomly assigned for vitamin C supplements (`trt`), either by ascorbic
acid or orange juice (treatment labels 0 and 1, respectively).

The following examples show how to assess the assumptions necessary to
perform the traditional t-test (with equal variances) for difference in
mean teeth growth in R. The full R script is provided in the
`teeth_Lab4.r` file posted in Canvas.

```{r}
library(readr)
guinea_teeth <- read_csv("guinea_teeth.csv", col_types = cols(trt = 
                                            col_factor(levels = c("0", "1"))))
```

```{r}
BF.var.test <- function(dat.response, dat.treatment){
  n1 = length(dat.response[dat.treatment==levels(dat.treatment)[1]])
  n2 = length(dat.response[dat.treatment==levels(dat.treatment)[2]])
  M = c(rep(median(dat.response[dat.treatment==levels(dat.treatment)[1]]), n1),
        rep(median(dat.response[dat.treatment==levels(dat.treatment)[2]]),n2))
  Z = abs(c(dat.response[dat.treatment==levels(dat.treatment)[1]], 
            dat.response[dat.treatment==levels(dat.treatment)[2]]) - M)
  G = c(dat.treatment[dat.treatment==levels(dat.treatment)[1]], 
        dat.treatment[dat.treatment==levels(dat.treatment)[2]])
  df = length(Z)-2
  BFstat = (t.test(Z~G, var.equal=T)$statistic)^2
  pval = pf(BFstat, 1, df, lower.tail=F)
  return(data.frame(BFstat=BFstat, pval=pval, row.names="results:"))
}           
```
        
```{r}
BF.var.test(guinea_teeth$growth, guinea_teeth$trt)
```

```{r}
library(tidyverse)
library(moments)
numerical_stats <- guinea_teeth |> group_by(trt) |> summarize(
    Y_mean = mean(growth),
    Y_med = quantile(growth, 0.5),
    Y_sd = sd(growth),
    Y_IQR = quantile(growth, 0.75) - quantile(growth, 0.25),
    Y_skew = skewness(growth),
    Y_kurt = kurtosis(growth),
    Y_excess = Y_kurt - 3)
numerical_stats
```

**[Remedies in R]{.underline}**

Refer to the guinea pig teeth study described above.

```{r}
t.test(growth~trt, data=guinea_teeth, var.equal=T)
```

```{r}
t.test(growth~trt, data=guinea_teeth, var.equal=F)
```

```{r}
wilcox.test(growth~trt, data=guinea_teeth, exact=F)
```

Now, consider another dataset containing the radon concentration levels
(`radon`) for a selection of homes in two different counties (`county`)
in Minnesota, Olmsted and Stearns. The data are found in the
`minn_radon.csv` file posted in Canvas. While exploring this dataset,
you should see that the radon concentration levels are non-normal within
the counties. One possible remedy for this if the researchers desire a
model-based inferential procedure is to find a transformation of the
data that will result in normality. The following example will show you
how to conduct the transformation in R:

```{r}
library(readr)
minn_radon <- read_csv("minn_radon.csv",
                       col_types = cols(county = 
                       col_factor(levels = c("OLMSTED", "STEARNS")))
                       )
```

-   Now, transform the response variable using the appropriate function
    in R:

    -   Square-root transformation: `X = sqrt(minn_radon$radon)`

    -   Log transformation: `X = log(minn_radon$radon)`

    -   Arcsin-root transformation: `X = asin(sqrt(minn_radon$radon))`

    -   Box-Cox transformation
        $\left(X = \dfrac{Y^{\lambda}-1}{\lambda} \right)$:

```{r}
library(MASS)
bct <- boxcox(lm(radon~county, data=minn_radon))
lambda <- bct$x[which.max(bct$y)]
X=(minn_radon$radon^lambda-1)/lambda
```

```{r}
minn_radon = cbind(minn_radon, X)
```

\newpage

**[Assignment]{.underline}**

# 1.  
Use R to assess the assumptions of the traditional $t$-based inference procedure for the guinea pig teeth study:

> 1.  Describe the independent treatment groups assumption in the context of the study. Explain why this assumption is valid.

Description: Our assumption is that guinea pigs (our units for the study) have independence both within and between the two groups, and that all units for a particular group belong to the same population (identically distributed). In the context of this study, we have no reason to assume this is violated, as our participants are all guinea pigs taken from the same pool of guinea pigs, and their treatments are randomly assigned, e.g. we have no reason to believe the total pool of guinea pigs was composed of two distinct types of guinea pigs or some underlying condition existing within the population that would warrant the believe of more than one population being contained within each sample. 

\newpage

> 2.  Describe the equal variance assumption in the context of the study. Check whether this assumption is appropriate. Justify your response by including all relevant graphs, summary statistics, test results, etc.

```{r}
sd(guinea_teeth$growth[guinea_teeth$trt=="1"])/
sd(guinea_teeth$growth[guinea_teeth$trt=="0"])
```

```{r}
var.test(
  x=guinea_teeth$growth[guinea_teeth$trt=="1"],
  y=guinea_teeth$growth[guinea_teeth$trt=="0"], 
  alternative="greater")
```

```{r}
boxplot(guinea_teeth$growth ~ guinea_teeth$trt, 
        xlab="Treatment", 
        ylab="Growth", 
        main="Guinea Pig Teeth Experiment")
```

Description: In the context of the study, the equal variance assumption is interpreted as meaning we presume the variability in the growth of teeth between the guinea pigs whose diets were of ascorbic acid or orange juice (treatment labels 0 and 1, respectively) are equal, that is to say both groups of guinea pigs vary equally in the growth of teeth. 

Justification: The above box plots show obvious differences in skewness, which would lead us to consider our assumption of equal variances to be violated. Furthermore, use of the F-test provides some evidence to consider rejecting the null hypothesis of no difference in variance to support the alternative hypothesis that there is some difference in the variances of the two groups. 

\newpage

> 3.  Describe the normal distribution assumption in the context of the study. Check whether this assumption is appropriate. Justify your response by including all relevant graphs, summary statistics, test results, etc.

```{r}
par(mfrow=c(2,1))
hist(guinea_teeth$growth[guinea_teeth$trt=="1"],
  main="Treatment = orange juice", 
  xlab="Growth", 
  xlim = range(c(2, 22)), 
  breaks = 8
  )
hist(guinea_teeth$growth[guinea_teeth$trt=="0"],
  main="Treatment = ascorbic acid", 
  xlab="Growth", 
  xlim = range(c(2, 22)),
  breaks = 8
  )
```

```{r}
sd(guinea_teeth$growth[guinea_teeth$trt=="1"])/
sd(guinea_teeth$growth[guinea_teeth$trt=="0"])
```

```{r}
shapiro.test(guinea_teeth$growth[guinea_teeth$trt=="1"])
shapiro.test(guinea_teeth$growth[guinea_teeth$trt=="0"])
```

```{r}
par(mfrow=c(1,2))
qqnorm(scale(guinea_teeth$growth[guinea_teeth$trt=="1"]),
  main="Treatment = orange juice")
abline(a=0, b=1, col="red")
qqnorm(scale(guinea_teeth$growth[guinea_teeth$trt=="0"]),
  main="Treatment = ascorbic acid")
abline(a=0, b=1, col="red")
```

Description: In the context of the study, the normal distribution assumption may be interpreted as meaning that the distribution of the teeth growth of guinea pigs is normally distributed, and that this assumption holds both for the guinea pigs whose diets were of ascorbic acid or orange juice (treatment labels 0 and 1, respectively). 

Justification: We have evidence to reject the assumption that our data is normally distributed. We have skewness in our data, as evidenced by the box plots shown in the above problem. The ratio of sample standard deviations is 1.62, which according to slides should have "little impact". Shapiro-Wilk normality test also provide some evidence that each group of guinea pigs may or may not be normally distributed. Taken in conjunction, while we do have evidence to show that our population (and each treatment group) may not be normally distributed, we don't have any information that would overwhelmingly forewarn us of inappropriateness of our typical procedure, i.e. using the typical t-test. 

\newpage

# 2.  
Perform a Wilcoxon rank-sum test to determine if the distributions of teeth lengths are the same for the two treatment groups.

```{r}
wilcox.test(growth~trt, data=guinea_teeth, exact=F)
```

> 1.  What is the value of the test statistic $W$? What is the corresponding sum of the ranks in the first group?

The $W$ statistic for the Wilcoxon rank-sum test is the same as the corresponding sum of the ranks in the first group, which is $W = 19.5$. 

> 2.  What is the value of the $p$-value?

The p-value for this test is f-value:$= 0.02319$. 

> 3.  Interpret the result of the test in the context of the study.

In the context of p-value is the likelihood we observed the results we did given the null hypothesis. Where: 
  - Null Hypothesis: Distribution of response variable (teeth growth) is the same for both groups (of guinea pigs).
  - Alternative Hypothesis: Distribution of response variable (teeth growth) is different between the two groups (of guinea pigs).

So we have low likelihood attributed to the median of the differences in teeth growth being observed if there was no difference in the median of teeth growth in the guinea pigs. Said differently, we have evidence to support the alternative hypothesis that there is a difference in the median teeth growth of guinea pigs with an ascorbic acid diet compared to the median value of guinea pigs treated with an orange juice diet. 

\newpage

# 3.  
Use R to complete the following exercises for the radon study:

> 1.  Which transformation of the data will result in normal distributions of radon concentration levels within each county?

We use the Box-Cox transformation to transform the data into something (more) normally distributed for radon concentration levels. 

We verify this normalized the data by checking the following: 

```{r}
hist(minn_radon$X, xlab = "Box-Cox Transformed Radon Levels", main = "Overall", freq = FALSE)
lines(density(minn_radon$X), col = "black", lwd = 2)
```
Which appears, approximately, normal. 

However, if we look at the radon levels before and after using Quantile plots we have: 


> Before 

```{r}
par(mfrow=c(1,2))
qqnorm(scale(minn_radon$radon[minn_radon$county=="OLMSTED"]),
  main="Treatment = OLMSTED")
abline(a=0, b=1, col="red")
qqnorm(scale(minn_radon$radon[minn_radon$county=="STEARNS"]),
  main="Treatment = STEARNS")
abline(a=0, b=1, col="red")
```

> After Box-Cox Transformation

```{r}
par(mfrow=c(1,2))
qqnorm(scale(minn_radon$X[minn_radon$county=="OLMSTED"]),
  main="Treatment = OLMSTED")
abline(a=0, b=1, col="red")
qqnorm(scale(minn_radon$X[minn_radon$county=="STEARNS"]),
  main="Treatment = STEARNS")
abline(a=0, b=1, col="red")
```
We do see that this transformation has made progress in normalizing the data (many more values are close to the plotted quantile line as well as more values being nearer to the 0-th theoretical quantile). 

> 2.  Conduct the traditional t-test (with equal variances) for the transformed data. Interpret the results in the context of the study.

```{r}
t.test(X~county, data=minn_radon, var.equal=T)
```

With a p-value of $0.4541$, we do not have substantive evidence to reject the null hypothesis, which is that the difference in average levels of radon (more on this shortly, because this is not just your typical "radon levels"!) between Olmsted and Stearns county is zero. 

However, it is worth noting that this test was done on the Box-Cox transformed response variable (radon levels), so we should instead say that we observe a p-value of $0.4541$ and a 95% Confidence Interval of (-0.733, 0.333) provide evidence to not reject the null hypothesis and support the observation that the difference in **average Box-Cox transformed levels of radon** between Olmsted and Stearns county is zero. 

**Total:** 25 points **\# correct:** **%:**
